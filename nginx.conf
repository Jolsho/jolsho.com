user www-data;
worker_processes auto;
error_log /var/log/nginx/error.log warn;
pid /run/nginx.pid;

events {
    worker_connections 1024;
}

rtmp {
    server {
        listen 1936 ssl;  # separate port for RTMPS
        chunk_size 4096;

        ssl_certificate /etc/letsencrypt/live/yourdomain.com/fullchain.pem;
        ssl_certificate_key /etc/letsencrypt/live/yourdomain.com/privkey.pem;

        application live {
            live on;

            allow publish 123.45.67.89;  # your home IP
            deny publish all;

            on_publish "exec /usr/local/bin/check_stream_key.sh $name";

            hls on;
            hls_path /var/www/hls;
            hls_fragment 3s;
        }
    }
}
